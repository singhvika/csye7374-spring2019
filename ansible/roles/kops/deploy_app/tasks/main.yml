---
#roles/deploy_pod/tasks

  - name: Get aws account id
    shell: "aws sts get-caller-identity --output text --query 'Account'"
    register: accountId

  - name: Jinja template copy for configmap file
    template:
      src: configmap-template.yaml
      dest: "{{ playbook_dir }}/../k8s/app/configmap.yaml"

  - name: Jinja template copy for load balancer file
    template:
      src: loadbalancer-template.yaml
      dest: "{{ playbook_dir }}/../k8s/app/loadbalancer.yaml"

  - name: Jinja template copy for replication controller file
    template:
      src: replication-controller-template.yaml
      dest: "{{ playbook_dir }}/../k8s/app/replication-controller.yaml"
  
  - name: Jinja template copy for initial application deployment File
    template:
      src: init-deployment-template.yaml
      dest: "{{ playbook_dir }}/../k8s/app/init-deployment.yaml"

  - name: Jinja template copy for jenkins application deployment File
    template:
      src: jenkins-deployment-template.yaml
      dest: "{{ playbook_dir }}/../k8s/app/deployment.yaml"

  - name: Deploy configmap
    shell: "kubectl apply -f {{ playbook_dir }}/../k8s/app/configmap.yaml"

  - name: Deploy secret
    shell: "kubectl apply -f {{ playbook_dir }}/../k8s/app/db-secret.yaml"

  - name: Deploy load balancer service
    shell: "kubectl apply -f {{ playbook_dir }}/../k8s/app/loadbalancer.yaml"
  
  - name: Deploy initial application deployment
    shell: "kubectl apply -f {{ playbook_dir }}/../k8s/app/init-deployment.yaml"

  - name: Autoscale Deployment
    shell: "kubectl autoscale deployment csye7374-{{deploymentName}} --cpu-percent=5 --min=2 --max=10"

...